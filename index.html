<!doctype html>
<html lang="en">
  <!--
All Rights Reserved
Copyright (c) 2025 Sofia Kaur
Unauthorized copying of this file, via any medium is strictly prohibited.
-->
<head>
  <!-- Google Tag Manager -->
  <script>
    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id=GTM-PZSNLRJ4'+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-PZSNLRJ4');
  </script>
  <!-- End Google Tag Manager -->
   <!-- Google Analytics 4 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-P1B1RV7TDY"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-P1B1RV7TDY');
  </script>
  <!-- End Google Analytics 4 -->

<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<link rel="manifest" href="site.webmanifest">
<meta name="theme-color" content="#ffb300">
<title>Trivia Thief ‚Äî Quiz</title>
<style>
  :root{
    --bg:#fff6e5; --card:#fffdfa; --accent:#ff9800; --primary:#ffb300;
    --muted:#666; --success:#4caf50; --danger:#f44336;
    --card-shadow:0 8px 28px rgba(0,0,0,.12);
    --btn-shadow:0 2px 10px #ffe6b7;
  }
  html,body{height:100%;margin:0;padding:0;}
  body{
    background:var(--bg);
    font-family: "Segoe UI", Roboto, Arial, sans-serif;
    display:flex;align-items:center;justify-content:center;
    min-height:100vh;
    padding:16px;
  }
  .screen{
    background:var(--card);
    width:100%;
    max-width:370px;
    border-radius:22px;box-shadow:var(--card-shadow);
    padding:28px 18px 22px 18px;
    box-sizing:border-box;
    text-align:center;
    position:relative;
    overflow:hidden;
    margin:auto;
    min-height:auto;
    display:flex;
    flex-direction:column;
    justify-content:flex-start;
    align-items:center;
    transition: max-width .2s, padding .2s;
  }
  @media (max-width:420px){
    .screen{max-width:99vw;padding:12px 2vw 14vw 2vw;}
  }
  .logo{width:80px;margin-bottom:10px}
  h1{margin:6px 0 4px;color:var(--accent);font-size:26px;font-weight:700}
  .avatars{display:flex;gap:14px;justify-content:center;margin-bottom:14px;}
  .avatar{width:56px;height:56px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:30px;cursor:pointer;border:3px solid transparent;background:white;position:relative;box-shadow:var(--btn-shadow);}
  .avatar.selected{border-color:var(--primary);transform:scale(1.06)}
  .avatar[data-locked="true"]::after{
    content:"üîí";
    position:absolute;
    bottom:4px; right:4px;
    font-size:14px;
  }
  input[type="text"] {
    width: 100%;
    padding: 12px;
    border-radius: 20px;
    border: 1px solid #e0e0e0;
    background: #eaf2ff;
    text-align: center;
    margin-bottom: 14px;
    box-sizing: border-box;
    font-size: 16px;
  }
  .btn{display:inline-block;width:100%;padding:14px;border-radius:28px;border:none;background:linear-gradient(135deg,var(--primary),var(--accent));color:#fff;font-weight:700;cursor:pointer;box-shadow:var(--btn-shadow);transition:box-shadow .1s, transform .1s;}
  .btn.small{width:auto;padding:10px 12px;border-radius:20px;font-size:14px}
  .btn:active{box-shadow:0 1px 2px #ffe6b7;transform:scale(.97);}
  .btn.faded, .btn[disabled]{
    opacity:.45;
    cursor:not-allowed;
    filter: grayscale(0.2) brightness(1.09);
    pointer-events: none;
    box-shadow:none;
  }
  .progress-bar{
    height:10px;background:#eee;border-radius:8px;overflow:hidden;margin-bottom:12px;
    box-shadow:0 2px 8px #ffe0b3;
  }
  .progress-fill{
    height:100%;width:0;
    background:var(--accent);
    transition:width .25s linear, background .18s;
    border-radius:8px;
  }
  .progress-fill.lowtime{background:var(--danger);}
  .question{font-weight:700;font-size:19px;color:#222;min-height:45px;display:flex;align-items:center;justify-content:center;margin-bottom:4px;}
  .options{display:flex;flex-direction:column;gap:10px;margin-top:8px;margin-bottom:12px;}
  .answer-btn{
    background:#fff;border:2px solid #ffd796;padding:12px 0;border-radius:12px;cursor:pointer;font-weight:600;transition:background .16s, box-shadow .11s, border .13s, color .13s;
    box-shadow:var(--btn-shadow);
    font-size:1em;
  }
  .answer-btn:hover, .answer-btn:focus{
    background:#fffbe6;
    box-shadow:0 3px 12px #ffe6b7;
    border-color:var(--primary);
    color:var(--accent);
    outline:none;
  }
  .answer-btn:active{
    background:#ffefd0;
    transform:scale(.98);
  }
  .answer-btn.correct{background:var(--success);color:#fff;border-color:var(--success);}
  .answer-btn.wrong{background:var(--danger);color:#fff;border-color:var(--danger);}
  .answer-btn.disabled{opacity:.6;cursor:not-allowed}
  .avatar-small { width:38px;height:38px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:#fff;font-size:21px;}
  .lifeline-row{
    margin: 10px auto 0 auto;
    padding: 0 0 0 0;
    display: flex;
    justify-content: center;
    gap: 23px;
    width: 100%;
    background: none;
    position:relative;
    z-index:10;
    pointer-events:auto;
  }
  .lifeline-btn{
    width:46px;height:46px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,var(--primary),var(--accent));color:white;font-size:22px;border:none;cursor:pointer;position:relative;box-shadow:var(--btn-shadow);pointer-events: auto;
    transition:box-shadow .18s,transform .1s;
  }
  .lifeline-btn:hover, .lifeline-btn:focus{
    box-shadow:0 5px 18px #ffe6b7;
    outline:none;
    background:linear-gradient(135deg,var(--accent),var(--primary));
    color:#fffde6;
    transform:scale(1.05);
  }
  .lifeline-btn:active{transform:scale(.95);}
  .lifeline-btn.used, .lifeline-btn[disabled]{
    opacity:.43;transform:scale(.96);cursor:not-allowed;filter: grayscale(0.2) brightness(1.08);
    box-shadow:none;
    pointer-events: none;
  }
  .lifeline-cost-label {
    font-size: 13px;
    color: #ff9800;
    background: #fffdfa;
    border-radius: 11px;
    padding: 1px 8px 2px 8px;
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    bottom: -20px;
    display: flex;
    align-items: center;
    gap: 3px;
    pointer-events: none;
    font-weight: 700;
    box-shadow:0 1px 4px #ffe0b7;
    letter-spacing:0.5px;
  }
  .meta{font-size:14px;color:var(--muted);margin-top:7px}
  .badge{width:90px;height:90px;border-radius:50%;margin:10px auto 10px auto;background:linear-gradient(180deg,#ffd54f,#ffb300);display:flex;align-items:center;justify-content:center;box-shadow:var(--btn-shadow);}
  #rewardChest{display:none;margin-top:10px}
  #chestImage{width:80px;transition:transform .3s}
  #chestImage.opened{transform:translateY(-6px) rotate(-6deg)}
  .funfact{position:fixed;left:50%;transform:translateX(-50%);bottom:-120px;background:#fff8e1;padding:12px 18px;border-radius:14px;box-shadow:0 8px 22px rgba(0,0,0,.12);transition:bottom .35s ease,opacity .35s ease;opacity:0;z-index:120}
  .funfact.show{bottom:72px;opacity:1}
</style>
</head>
<body>
  <!-- Google Tag Manager (noscript) -->
  <noscript>
    <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PZSNLRJ4"
    height="0" width="0" style="display:none;visibility:hidden"></iframe>
  </noscript>
  <!-- End Google Tag Manager (noscript) -->
<!-- Start View -->
<div class="screen" role="application" aria-label="Trivia Thief Game">
  <div id="view-start" class="view active">
    <img class="logo" src="logo.png" alt="Trivia Thief Logo">
    <p class="tag"><strong>A Game Can Make You Millionaire</strong></p>
    <h1>QUIZ GAME</h1>
    <div class="avatars" id="avatarRow">
      <div class="avatar" data-id="cat" title="Cat" role="button" aria-label="Select Cat avatar" tabindex="0">üê±</div>
      <div class="avatar" data-id="dog" title="Dog" role="button" aria-label="Select Dog avatar" tabindex="0">üê∂</div>
      <div class="avatar" data-id="owl" data-locked="true" title="Owl" role="button" aria-label="Select Owl avatar (locked)" aria-disabled="true" tabindex="0">ü¶â</div>
      <div class="avatar" data-id="alien" data-locked="true" title="Alien" role="button" aria-label="Select Alien avatar (locked)" aria-disabled="true" tabindex="0">üëΩ</div>
    </div>
    <input id="nameInput" type="text" placeholder="Enter your name" aria-label="Enter your name" autocomplete="name" />
    <div style="height:10px"></div>
    <button id="startBtn" class="btn" aria-label="Start the quiz">Start</button>
    <div style="margin-top:10px"><button class="btn small" type="button" id="instructionsBtn" aria-label="Show instructions">Instructions</button></div>
    <div class="meta">Tap avatar, enter name, then press Start</div>
    <div style="margin-top:10px;display:flex;align-items:center;justify-content:center;gap:6px;">
      <img src="coin.png" alt="Coins" style="width:20px;height:20px">
      <span id="coinCount" style="font-weight:600" aria-live="polite">0</span>
    </div>
  </div>
  <!-- Difficulty View -->
  <div id="view-difficulty" class="view" style="display:none">
    <h2 style="margin-bottom:18px;">Select Difficulty</h2>
    <div style="display:flex;flex-direction:column;gap:10px;">
      <button class="btn" data-diff="easy" aria-label="Select easy difficulty">Easy</button>
      <button class="btn" data-diff="medium" aria-label="Select medium difficulty">Medium</button>
      <button class="btn" data-diff="hard" aria-label="Select hard difficulty">Hard</button>
    </div>
    <div class="meta" style="margin-top:14px;">Questions will be pulled randomly from the chosen pool.</div>
    <div style="margin-top:16px"><button class="btn small" id="backToStart" aria-label="Back to main menu">Back</button></div>
  </div>
  <!-- Quiz View -->
  <div id="view-quiz" class="view" style="display:none;position:relative;">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <div style="display:flex;align-items:center;gap:8px">
        <div class="avatar-small" id="headerAvatar" aria-label="Selected avatar"></div>
        <span id="headerUsername" style="font-weight:600" aria-label="Player name"></span>
      </div>
      <div style="display:flex;align-items:center;gap:6px">
        <img src="coin.png" alt="Coins" style="width:20px;height:20px">
        <span id="coinCountQuiz" style="font-weight:600" aria-live="polite">0</span>
      </div>
    </div>
    <div id="progressText" class="meta" aria-live="polite"></div>
    <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="10" aria-label="Quiz progress"><div id="progressFill" class="progress-fill"></div></div>
    <div id="questionText" class="question" aria-live="polite">Question will appear here</div>
    <div id="optionsContainer" class="options" role="list"></div>
    <div class="lifeline-row" id="lifelineRow">
      <button id="btnHint" class="lifeline-btn lifeline-hint" aria-label="Use hint lifeline (costs 20 coins)">
        <span style="font-size:1.2em;line-height:1.1;">üí°</span>
        <span class="lifeline-cost-label">20 <img src="coin.png" width="13" alt="Coins"></span>
      </button>
      <button id="btn5050" class="lifeline-btn lifeline-5050" aria-label="Use 50/50 lifeline (costs 30 coins)">
        <span style="font-size:1.1em;line-height:1.1;">‚úÇÔ∏è</span>
        <span class="lifeline-cost-label">30 <img src="coin.png" width="13" alt="Coins"></span>
      </button>
    </div>
  </div>
  <!-- End View -->
  <div id="view-end" class="view" style="display:none">
    <div id="badge" class="badge" style="display:none"><img id="badgeImage" src="" alt="Badge" style="width:80%;height:auto;border-radius:50%"></div>
    <h2 id="endTitle">You Win!</h2>
    <div id="motivationalQuote" class="meta" style="color:#b97b16;margin-bottom:8px;font-weight:600"></div>
    <div id="playerSummary" class="meta"></div>
    <div style="margin-top:12px">
      <button class="btn" id="playAgainBtn" aria-label="Play again">Play Again</button>
      <button class="btn small" id="mainMenuBtn" style="margin-top:8px" aria-label="Go to main menu">Main Menu</button>
    </div>
    <div id="rewardChest" style="text-align:center;display:none">
      <img src="chest_closed.png" id="chestImage" alt="Chest">
      <div style="margin-top:8px"><button id="openChestBtn" class="btn small" aria-label="Open reward chest">Open Chest</button></div>
    </div>
    <div style="margin-top:14px;text-align:left">
      <h3 style="margin:8px 0 6px">Leaderboard</h3>
      <ol id="leaderboardList" style="padding-left:18px;margin:0 0 6px 0"></ol>
    </div>
  </div>
  <div id="funFact" class="funfact" aria-live="polite" aria-hidden="true"></div>
</div>
<div id="instructionsModal" style="display:none;position:fixed;left:0;top:0;width:100vw;height:100vh;background:rgba(0,0,0,.36);align-items:center;justify-content:center;z-index:200">
  <div style="background:white;padding:20px;border-radius:12px;max-width:340px;margin:auto;text-align:left">
    <button id="closeInstructions" style="float:right" aria-label="Close instructions">√ó</button>
    <h2 style="color:var(--accent)">How to Play</h2>
    <ol>
      <li>Pick avatar and enter name.</li>
      <li>Start ‚Üí choose difficulty ‚Üí answer questions.</li>
      <li>You earn coins for correct answers and can buy lifelines.</li>
    </ol>
  </div>
</div>

<!-- SOUND EFFECTS -->
<audio id="sfxStart" src="start.wav" preload="auto"></audio>
<audio id="sfxTimer" src="tick.wav" preload="auto" loop></audio>
<audio id="sfxCoin" src="coin.wav" preload="auto"></audio>
<audio id="sfxChest" src="chest.wav" preload="auto"></audio>

<script>
const QUESTION_LIMIT = 10, HINT_COST = 20, FIFTY_COST = 30, AVATAR_UNLOCK_COST = 100;
const MOTIVATIONAL_QUOTES = [
  "Don't give up! Every failure is a step to success.",
  "Mistakes are proof you are trying.",
  "Believe in yourself and try again!",
  "Great things take time. Keep going!",
  "Every champion was once a contender that refused to give up.",
  "You learn more from losing than winning.",
  "Try again, you are getting better!",
  "Persistence guarantees that results are inevitable.",
  "Success is not final, failure is not fatal: It is the courage to continue that counts.",
  "Your next attempt could be your best yet!"
];
const state = {
  name: '',
  avatarId: '',
  difficulty: '',
  pool: [],
  index: 0,
  correctCount: 0,
  coins: 0,
  timerVal: 10,
  timerHandle: null,
  used5050: false,
  usedHint: false
};
const byId = id => document.getElementById(id);

// --- SOUND FX HELPERS ---
function playSFX(id, loop=false) {
  const el = document.getElementById(id);
  if (el) {
    el.loop = loop;
    el.currentTime = 0;
    el.play().catch(()=>{});
  }
}
function stopSFX(id) {
  const el = document.getElementById(id);
  if (el) {
    el.pause();
    el.currentTime = 0;
  }
}
// ---

function updateCoins(amount) {
  state.coins += amount;
  if (state.coins < 0) state.coins = 0;
  localStorage.setItem('quizCoins', String(state.coins));
  byId('coinCount').textContent = state.coins;
  byId('coinCountQuiz').textContent = state.coins;
  if(amount > 0) playSFX('sfxCoin');
}
function getAvatarEmoji(id) {
  return ({cat:'üê±', dog:'üê∂', owl:'ü¶â', alien:'üëΩ'}[id] || 'üôÇ');
}
function showView(id) {
  ['view-start','view-difficulty','view-quiz','view-end'].forEach(v => {
    const el = byId(v);
    if (!el) return;
    el.style.display = (v === id) ? 'block' : 'none';
  });
  // --- SOUND HANDLING ---
  if (id === 'view-start' || id === 'view-end') {
    playSFX('sfxStart');
    stopSFX('sfxTimer');
  } else {
    stopSFX('sfxStart');
  }
}
function resetLifelines() {
  state.used5050 = false;
  state.usedHint = false;
  byId('btn5050').classList.remove('used');
  byId('btnHint').classList.remove('used');
}
function startTimer() {
  clearTimer();
  state.timerVal = 10;
  const fill = byId('progressFill');
  if (fill) { fill.style.width = '100%'; fill.classList.remove('lowtime'); }
  state.timerHandle = setInterval(() => {
    state.timerVal--;
    if (fill) {
      fill.style.width = (Math.max(state.timerVal,0) / 10) * 100 + '%';
      if(state.timerVal <= 3){ fill.classList.add('lowtime'); } else { fill.classList.remove('lowtime'); }
    }
    if (state.timerVal <= 0) {
      clearTimer();
      onTimeout();
    }
  }, 1000);
}
function clearTimer() {
  if (state.timerHandle) { clearInterval(state.timerHandle); state.timerHandle = null; }
  stopSFX('sfxTimer');
}
const fallbackQuestions = {
  easy: [
    { q:"2 + 2 = ?", options:["3","4","5","6"], answer:"4", hint:"Even", fact:"2+2=4 ‚Äî basic math" },
    { q:"Color of the sky?", options:["Blue","Green","Red","Yellow"], answer:"Blue", hint:"Daytime", fact:"Sky appears blue due to scattering" },
    { q:"Which animal barks?", options:["Cat","Dog","Cow","Tiger"], answer:"Dog", hint:"Man's best friend", fact:"Dogs bark to communicate." },
    { q:"Sun rises in?", options:["North","South","East","West"], answer:"East", hint:"Opposite of west", fact:"Because Earth rotates west‚Üíeast." },
    { q:"How many days in a week?", options:["5","6","7","8"], answer:"7", hint:"Lucky number", fact:"A week has seven days." }
  ],
  medium: [
    { q:"Capital of France?", options:["Berlin","Paris","Rome","Madrid"], answer:"Paris", hint:"City of Light", fact:"Paris is very famous." },
    { q:"Who wrote '1984'?", options:["Orwell","Huxley","Austen","Shakespeare"], answer:"Orwell", hint:"Also wrote Animal Farm", fact:"George Orwell wrote 1984." },
    { q:"Square root of 144?", options:["10","11","12","13"], answer:"12", hint:"A dozen", fact:"12 √ó 12 = 144." },
    { q:"Gas needed for combustion?", options:["Nitrogen","Oxygen","CO2","Helium"], answer:"Oxygen", hint:"We breathe it", fact:"Oxygen supports fire." },
    { q:"Fastest land animal?", options:["Lion","Cheetah","Elephant","Horse"], answer:"Cheetah", hint:"Spotted cat", fact:"Cheetahs exceed 100 km/h." }
  ],
  hard: [
    { q:"Who developed relativity?", options:["Newton","Einstein","Bohr","Tesla"], answer:"Einstein", hint:"E=mc¬≤", fact:"Einstein proposed relativity." },
    { q:"Atomic number of Oxygen?", options:["6","7","8","9"], answer:"8", hint:"Even number", fact:"Oxygen is atomic number 8." },
    { q:"Speed of light approx?", options:["3√ó10^8 m/s","3√ó10^6 m/s","3√ó10^5 m/s","3√ó10^7 m/s"], answer:"3√ó10^8 m/s", hint:"Very fast", fact:"Light is ~300,000 km/s." },
    { q:"Avogadro's number approx?", options:["6.02√ó10^23","3.14","1.6√ó10^-19","9.8"], answer:"6.02√ó10^23", hint:"Huge", fact:"Particles in one mole." },
    { q:"Element with symbol 'Au'?", options:["Silver","Gold","Argon","Platinum"], answer:"Gold", hint:"Precious metal", fact:"Au = Aurum (Latin)." }
  ]
};
let questionBank = {easy:[],medium:[],hard:[]};
async function loadQuestions() {
  try {
    const res = await fetch('questions.json');
    if (!res.ok) throw new Error("Failed to fetch");
    const data = await res.json();
    if (data && Array.isArray(data.easy) && Array.isArray(data.medium) && Array.isArray(data.hard)) {
      questionBank = {
        easy: (data.easy.length >= 5 ? data.easy.slice(0) : data.easy.concat(fallbackQuestions.easy.slice(0,5-data.easy.length))),
        medium: (data.medium.length >= 5 ? data.medium.slice(0) : data.medium.concat(fallbackQuestions.medium.slice(0,5-data.medium.length))),
        hard: (data.hard.length >= 5 ? data.hard.slice(0) : data.hard.concat(fallbackQuestions.hard.slice(0,5-data.hard.length)))
      };
    } else {
      questionBank = {...fallbackQuestions};
    }
  } catch(e) {
    questionBank = {...fallbackQuestions};
  }
}
function getShuffledQuestions(level, count) {
  let arr = questionBank[level].slice();
  shuffleArray(arr);
  return arr.slice(0, Math.min(count, arr.length));
}
function updateProgress() {
  const total = state.pool.length || 1;
  const current = Math.min(state.index+1, total);
  byId('progressText').textContent = `Question ${current} of ${total}`;
  const progressBar = document.querySelector('.progress-bar');
  if(progressBar) {
    progressBar.setAttribute('aria-valuenow', current);
    progressBar.setAttribute('aria-valuemax', String(total));
  }
}
function onAnswer(btn, selected) {
  const opts = Array.from(document.querySelectorAll('.answer-btn'));
  opts.forEach(b => { b.classList.add('disabled'); b.disabled = true; });
  clearTimer();
  const q = state.pool[state.index];
  const correct = q.answer;
  if (selected === correct) {
    btn.classList.add('correct');
    state.correctCount++;
    updateCoins(10);
    if (q.fact) showFunFact(q.fact);
    setTimeout(() => { state.index++; renderQuestion(); }, 900);
  } else {
    btn.classList.add('wrong');
    opts.forEach(b => { if (b.textContent === correct) b.classList.add('correct'); });
    setTimeout(() => finishGame(false), 900);
  }
}
function onTimeout() {
  const opts = Array.from(document.querySelectorAll('.answer-btn'));
  const q = state.pool[state.index];
  opts.forEach(b => { b.classList.add('disabled'); b.disabled = true; if (b.textContent === q.answer) b.classList.add('correct'); });
  setTimeout(() => finishGame(false), 900);
}
const funFactEl = byId('funFact');
function showFunFact(text, closeAfter = 1600) {
  funFactEl.textContent = text || '';
  funFactEl.classList.add('show');
  funFactEl.setAttribute('aria-hidden','false');
  setTimeout(() => { funFactEl.classList.remove('show'); funFactEl.setAttribute('aria-hidden','true'); }, closeAfter);
}
const btn5050El = byId('btn5050');
const btnHintEl = byId('btnHint');
function updateLifelineStates() {
  btn5050El.disabled = state.used5050 || state.coins < 30;
  btnHintEl.disabled = state.usedHint || state.coins < 20;
  if (btn5050El.disabled) btn5050El.classList.add('used');
  else btn5050El.classList.remove('used');
  if (btnHintEl.disabled) btnHintEl.classList.add('used');
  else btnHintEl.classList.remove('used');
}
btn5050El.addEventListener('click', () => {
  if (!state.pool || !state.pool[state.index]) return;
  if (state.used5050 || state.coins < FIFTY_COST) return;
  state.used5050 = true;
  updateLifelineStates();
  updateCoins(-FIFTY_COST);
  const q = state.pool[state.index];
  const opts = Array.from(document.querySelectorAll('.answer-btn'));
  const wrongBtns = opts.filter(b => b.textContent !== q.answer && b.style.visibility !== 'hidden' && !b.classList.contains('disabled'));
  shuffleArray(wrongBtns);
  wrongBtns.slice(0,2).forEach(b => { b.style.visibility = 'hidden'; });
});
btnHintEl.addEventListener('click', () => {
  if (!state.pool || !state.pool[state.index]) return;
  if (state.usedHint || state.coins < HINT_COST) return;
  state.usedHint = true;
  updateLifelineStates();
  updateCoins(-HINT_COST);
  const q = state.pool[state.index];
  showFunFact("Hint: " + (q.hint || "No hint available"), 2200);
});
function saveToLeaderboard(win) {
  const board = JSON.parse(localStorage.getItem('quizLeaderboard') || '[]');
  board.push({ name: state.name, avatar: state.avatarId, difficulty: state.difficulty, score: state.correctCount, total: state.pool.length, win: !!win });
  board.sort((a,b) => (b.win - a.win) || (b.score - a.score));
  localStorage.setItem('quizLeaderboard', JSON.stringify(board.slice(0,10)));
}
function renderLeaderboard() {
  const list = byId('leaderboardList');
  list.innerHTML = '';
  const board = JSON.parse(localStorage.getItem('quizLeaderboard') || '[]');
  board.forEach(entry => {
    const li = document.createElement('li');
    li.innerHTML = `<strong>${entry.name}</strong> (${entry.difficulty.toUpperCase()}) - ${entry.score}/${entry.total}`;
    list.appendChild(li);
  });
}
function finishGame(win) {
  clearTimer();
  funFactEl.classList.remove('show');
  showView('view-end');
  if (win) {
    byId('endTitle').textContent = `üéâ Congratulations, ${state.name}! You Won!`;
    byId('badge').style.display = 'flex';
    if (!state.used5050 && !state.usedHint) {
      byId('badgeImage').src = 'badgeone.png';
    } else {
      byId('badgeImage').src = 'badgetwo.png';
    }
    byId('rewardChest').style.display = 'block';
    byId('chestImage').classList.remove('opened');
    const openBtn = byId('openChestBtn');
    if (openBtn) {
      openBtn.disabled = false;
      openBtn.classList.remove('faded');
      openBtn.dataset.opened = '0';
    }
    byId('motivationalQuote').textContent = "You‚Äôre a trivia master!";
  } else {
    byId('endTitle').textContent = `üò¢ Game Over, ${state.name}`;
    byId('badge').style.display = 'none';
    byId('rewardChest').style.display = 'none';
    byId('motivationalQuote').textContent = MOTIVATIONAL_QUOTES[Math.floor(Math.random()*MOTIVATIONAL_QUOTES.length)];
  }
  byId('playerSummary').textContent = `Score: ${state.correctCount}/${state.pool.length}`;
  renderLeaderboard();
  saveToLeaderboard(win);
}
function renderQuestion() {
  if (state.index >= state.pool.length) {
    finishGame(true);
    return;
  }
  updateProgress();
  const q = state.pool[state.index];
  byId('questionText').textContent = q.q;
  const container = byId('optionsContainer');
  container.innerHTML = '';
  let shuffledOptions = q.options.slice();
  shuffleArray(shuffledOptions);
  shuffledOptions.forEach(opt => {
    const btn = document.createElement('button');
    btn.className = 'answer-btn';
    btn.setAttribute('role', 'listitem');
    btn.setAttribute('aria-label', `Answer option: ${opt}`);
    btn.textContent = opt;
    btn.onclick = () => onAnswer(btn, opt);
    container.appendChild(btn);
  });
  Array.from(container.querySelectorAll('.answer-btn')).forEach(b => { b.style.visibility = 'visible'; b.classList.remove('disabled','correct','wrong'); b.disabled = false; });
  byId('headerAvatar').textContent = getAvatarEmoji(state.avatarId);
  byId('headerUsername').textContent = state.name;
  byId('coinCountQuiz').textContent = state.coins;
  updateLifelineStates();
  playSFX('sfxTimer', true); // Timer ticking sound
  startTimer();
}
function shuffleArray(a) {
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i+1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}
document.querySelectorAll('.avatar').forEach(a => {
  a.addEventListener('click', () => {
    if (a.dataset.locked === "true") {
      if (state.coins >= AVATAR_UNLOCK_COST && confirm(`Unlock this avatar for ${AVATAR_UNLOCK_COST} coins?`)) {
        updateCoins(-AVATAR_UNLOCK_COST);
        a.dataset.locked = "false";
        a.removeAttribute('aria-disabled');
        alert("Avatar unlocked!");
      } else {
        alert("This avatar is locked. Earn more coins to unlock.");
        return;
      }
    }
    document.querySelectorAll('.avatar').forEach(x => x.classList.remove('selected'));
    a.classList.add('selected');
    state.avatarId = a.dataset.id;
  });
  a.addEventListener('keydown', e => {
    if (e.key === 'Enter' || e.key === ' ') a.click();
  });
});
byId('startBtn').addEventListener('click', function initMusic() {
  const startEl = document.getElementById('sfxStart');
  if (startEl) {
    startEl.loop = true;
    startEl.currentTime = 0;
    startEl.play().catch(() => {});
  }
  if (!state.avatarId) return alert("Select an avatar first");
  if (!byId('nameInput').value.trim()) return alert("Enter your name");
  state.name = byId('nameInput').value.trim();
  showView('view-difficulty');
  byId('startBtn').removeEventListener('click', initMusic);
});

byId('openChestBtn').addEventListener('click', () => {
  const btn = byId('openChestBtn');
  if (!btn) return;
  if (btn.dataset.opened === '1') return;
  const coinsWon = Math.floor(Math.random() * 41) + 10;
  updateCoins(coinsWon);
  byId('chestImage').classList.add('opened');
  btn.dataset.opened = '1';
  btn.disabled = true;
  btn.classList.add('faded');
  playSFX('sfxChest');
  alert(`üéâ You won ${coinsWon} coins!`);
});
document.querySelectorAll('#view-difficulty .btn[data-diff]').forEach(btn => btn.addEventListener('click', async () => {
  await loadQuestions();
  state.difficulty = btn.dataset.diff;
  state.pool = getShuffledQuestions(state.difficulty, QUESTION_LIMIT);
  state.index = 0;
  state.correctCount = 0;
  resetLifelines();
  showView('view-quiz');
  renderQuestion();
}));
byId('playAgainBtn').addEventListener('click', () => { showView('view-difficulty'); });
byId('mainMenuBtn').addEventListener('click', () => { showView('view-start'); });
byId('instructionsBtn').addEventListener('click', () => { byId('instructionsModal').style.display = 'flex'; });
byId('closeInstructions').addEventListener('click', () => { byId('instructionsModal').style.display = 'none'; });
byId('backToStart').addEventListener('click', () => { showView('view-start'); });
state.coins = parseInt(localStorage.getItem('quizCoins') || '0', 10);
byId('coinCount').textContent = state.coins;
byId('coinCountQuiz').textContent = state.coins;
loadQuestions();
</script>
<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/service-worker.js')
      .then(reg => console.log('Service Worker registered', reg))
      .catch(err => console.log('SW registration failed:', err));
  });
}
</script>
<script>
let deferredPrompt;

window.addEventListener('beforeinstallprompt', (e) => {
  // Prevent Chrome from showing the default mini-infobar
  e.preventDefault();
  // Store the event so you can trigger it later
  deferredPrompt = e;

  // Create an install button
  const installBtn = document.createElement('button');
  installBtn.textContent = 'üì• Install App';
  installBtn.style.position = 'fixed';
  installBtn.style.bottom = '20px';
  installBtn.style.right = '20px';
  installBtn.style.zIndex = '9999';
  installBtn.style.padding = '10px 15px';
  installBtn.style.background = '#ff9800';
  installBtn.style.color = 'white';
  installBtn.style.border = 'none';
  installBtn.style.borderRadius = '5px';
  installBtn.style.cursor = 'pointer';

  // Add click event to trigger install prompt
  installBtn.addEventListener('click', () => {
    installBtn.style.display = 'none';
    deferredPrompt.prompt();
    deferredPrompt.userChoice.then((choiceResult) => {
      if (choiceResult.outcome === 'accepted') {
        console.log('User accepted the install');
      } else {
        console.log('User dismissed the install');
      }
      deferredPrompt = null;
    });
  });

  // Append the button to the body
  document.body.appendChild(installBtn);
});
/*
All Rights Reserved
Copyright (c) 2025 Sofia Kaur
Unauthorized copying of this file, via any medium is strictly prohibited.
*/

</script>
</body>
</html>
